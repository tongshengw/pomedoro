{%extends "layout.html"%}

{%block title%}Pomedoro{%endblock%}

{%block body%}
<main>
    
    <div class="options-bar">
        <div class="row">
    
            <div class="option">Focus</div>
            <div class="time-options">

                {%for i in range(countFocusTimes)%}
                    {%if i == countFocusTimes -1%}
                        <div class="text-button last-element">
                    {%else%}
                        <div class="text-button">
                    {%endif%}    
                            <button class="empty-button option-button">
                            <span>{{focusTimes[i]}}</span>
                        </button>
                    </div>
                {%endfor%}

            </div>
    
            <div class="spacer"></div>
    
            <div class="option first-element">Rest</div>
            <div class="time-options">
                {%for i in range(countRestTimes)%}
                    {%if i == countRestTimes -1%}
                        <div class="text-button last-element">
                    {%else%}
                        <div class="text-button">
                    {%endif%}    
                            <button class="empty-button option-button">
                            <span>{{restTimes[i]}}</span>
                        </button>
                    </div>
                {%endfor%}
            </div>
    
            <div class="spacer"></div>
    
            <div class="option first-element">Sessions</div>
            <div class="time-options">
                {%for i in range(countSessionCounts)%}
                    <div class="text-button">
                        <button class="empty-button option-button">
                        <span>{{sessionCounts[i]}}</span>
                        </button>
                    </div>
                {%endfor%}
            </div>
    
        </div>
    </div>
    

    <!-- <div style="height: 4rem;"></div> -->

    <div class="main-content">
        <div class="info invisible" id="time-left-text">15m 59s</div>
        <div class="progressbar-container">
            <div class="progressbar">
                <span id="percentage">0%</span>
            </div>
        </div>

        <div class = "button-container">
            <button id = "startButton" class = "button1">Start Focus</button> <button id="pauseButton" class = "button1 removed">Pause</button>
        </div>

    </div>

</main>
    

    
{%endblock%}

{%block script%}
    <script type="module">
        import {toMinSec} from '../static/helpers.js';

        var time = 130;
        var timeleft = time;
        var progressBar = document.getElementsByClassName("progressbar")[0];
        var started = false;
        var startButton = document.getElementById("startButton");
        var pauseButton = document.getElementById("pauseButton");
        
        var listenerAdded = false;
        startButton.addEventListener("click", function(){
            started = true;
            startButton.classList.add("removed")
            pauseButton.classList.remove("removed")
            if (listenerAdded == false) {
                listenerAdded = true;
                var x = setInterval(function() {
                    if (started == true && timeleft > 0) {
                    
                        timeleft -= 0.05;

                        var percentage = document.getElementById("percentage");

                        var smoothCompletion = ((1-timeleft/time) *100);
                        var completion = Math.round(smoothCompletion);

                        // completion is from 0-100 and is the percentage completion of the progress bar
                        percentage.innerHTML = completion + "%";
                        // console.log(completion)

                        progressBar.style.width = smoothCompletion*0.95+5 + "%";

                        document.getElementById("time-left-text").innerHTML = toMinSec(timeleft);
                        document.getElementById("time-left-text").classList.remove("invisible");
                            
                        if (timeleft <= 0) {
                            clearInterval(x);
                        }
                    }
                },50);
            }
            
        });
        
        pauseButton.addEventListener("click", function() {
            started = false;
            startButton.classList.remove("removed")
            pauseButton.classList.add("removed")
        });


    </script>
{%endblock%}